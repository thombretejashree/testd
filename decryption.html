<main class="container">
    <div class="page-title">
        <h1><i class="fas fa-unlock"></i> Decrypt Your Data</h1>
        <p>Access your encrypted data with the right key</p>
    </div>

    <div class="input-area">
        <h3><i class="fas fa-pencil-alt"></i> Enter Encrypted Text</h3>
        <textarea id="text-to-decrypt" class="text-input" placeholder="Paste your encrypted data here..."></textarea>
        
        <div class="upload-area">
            <i class="fas fa-file-upload"></i>
            <h3>Or Upload an Encrypted File</h3>
            <p>Select the .txt file from the encrypted .zip archive</p>
            <input type="file" id="encrypted-file-upload" style="display: none;">
            <button class="btn" onclick="document.getElementById('encrypted-file-upload').click()">
                <i class="fas fa-folder-open"></i> Select File
            </button>
        </div>
        </div>

    <div class="options">
        <h3><i class="fas fa-key"></i> Decryption Key</h3>
        <input type="text" id="decryption-key" class="key-input" placeholder="Enter the password used for encryption">
    </div>

    <div class="action-btn">
        <button id="decrypt-btn" class="btn">
            <i class="fas fa-unlock"></i> Decrypt Text
        </button>
    </div>
    
    <div id="decryption-result-box" style="display: none; margin-top: 30px;">
        <h3><i class="fas fa-file-alt"></i> Decrypted Text</h3>
        <textarea id="decrypted-output" class="text-input" readonly></textarea>
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
    const textInput = document.getElementById('text-to-decrypt');
    const fileInput = document.getElementById('encrypted-file-upload');
    const keyInput = document.getElementById('decryption-key');
    const decryptBtn = document.getElementById('decrypt-btn');
    const resultBox = document.getElementById('decryption-result-box');
    const decryptedOutput = document.getElementById('decrypted-output');

    // START: Added File Reader Logic
    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            textInput.value = e.target.result;
        };
        reader.readAsText(file);
    });
    // END: Added File Reader Logic

    decryptBtn.addEventListener('click', () => {
        const encryptedText = textInput.value;
        const password = keyInput.value;

        if (!encryptedText) {
            alert('Please enter or upload the text to decrypt.');
            return;
        }
        if (!password) {
            alert('Please enter the decryption key.');
            return;
        }

        try {
            const bytes = CryptoJS.AES.decrypt(encryptedText, password);
            const originalText = bytes.toString(CryptoJS.enc.Utf8);

            if (originalText) {
                decryptedOutput.value = originalText;
                resultBox.style.display = 'block';
            } else {
                throw new Error('Decryption failed. Check key or data.');
            }
        } catch (error) {
            console.error('Decryption Error:', error);
            alert('Decryption failed. Please make sure your key and encrypted text are correct.');
            resultBox.style.display = 'none';
        }
    });
</script>
